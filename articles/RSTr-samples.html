<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>07: Sample Processing • RSTr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="07: Sample Processing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RSTr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/RSTr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/RSTr-event.html">01: Understanding and Preparing Your Event Data</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-adjacency.html">02: Understanding and Preparing Your Adjacency Structure</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-car.html">03: The CAR Models</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-agestandardize.html">04: Generating Estimates: Age-standardization</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-reliability.html">05: Generating Estimates: Reliability and Suppression</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-informativeness.html">06: Model Informativeness</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-samples.html">07: Sample Processing</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-initialvalues.html">08: Initial Values</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-priors.html">09: Priors</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-models.html">Appendix A: The CAR Hierarchical Models</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-troubleshoot.html">Appendix B: Troubleshooting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>07: Sample Processing</h1>
            
      

      <div class="d-none name"><code>RSTr-samples.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In the first series of vignettes, we worked with high-level wrapper
functions like <code><a href="../reference/age_standardize.html">age_standardize()</a></code>,
<code><a href="../reference/suppress_estimates.html">suppress_estimates()</a></code>, and <code><a href="../reference/get_estimates.html">get_estimates()</a></code>. In
this vignette, we will be working with the functions that underlie these
wrappers and manually generating our estimates, unlocking the more
powerful capabilities of <code>RSTr</code>.</p>
<p>Before we begin, note that the above functions make direct changes to
our <code>RSTr</code> model object. We can manually save our estimates
to the model object, but these estimates will not be automatically
added. In exchange for more power with sample processing, we lose some
of the convenience afforded to us by these wrapper functions.</p>
</div>
<div class="section level2">
<h2 id="the-load_samples-function">The <code>load_samples()</code> function<a class="anchor" aria-label="anchor" href="#the-load_samples-function"></a>
</h2>
<p>To begin, let’s generate samples for a new model:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_mst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ucar.html">mstcar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"my_test_model"</span>, data <span class="op">=</span> <span class="va">miheart</span>, adjacency <span class="op">=</span> <span class="va">miadj</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting sampler on Batch 1 at Thu Dec 11 00:07:17</span></span></code></pre></div>
<p><img src="RSTr-samples_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" width="700"></p>
<pre><code><span><span class="co">#&gt; Generating estimates...</span></span>
<span><span class="co">#&gt; Model finished at Thu Dec 11 00:07:46</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="the-load_samples-function-1">The <code>load_samples()</code> function<a class="anchor" aria-label="anchor" href="#the-load_samples-function-1"></a>
</h2>
<p>Once <code><a href="../reference/ucar.html">mstcar()</a></code> tells you that the model is finished
running, you can import samples into R using
<code><a href="../reference/load_samples.html">load_samples()</a></code>. <code><a href="../reference/load_samples.html">load_samples()</a></code> takes in four
arguments:</p>
<ul>
<li><p><code>RSTr_obj</code>: Our <code>RSTr</code> model
object;</p></li>
<li><p><code>param</code>: The parameter to import samples for;
and</p></li>
<li><p><code>burn</code>: Specifies a burn-in period for samples. This
allows the model time to stabilize before using samples to generate
estimates. By default, has a burn-in period of 2000 samples.</p></li>
</ul>
<p>Any <code>dimnames</code> that were saved to <code>data</code> will
be applied to the samples as appropriate. Here, we pull in the
<code>lambda</code> samples for our test Michigan dataset with a
2000-sample burn-in period (as specified by the default arguments). We
also multiply by 100,000 as it is common to display mortality rates per
100,000 individuals:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_samples.html">load_samples</a></span><span class="op">(</span><span class="va">mod_mst</span>, param <span class="op">=</span> <span class="st">"lambda"</span>, burn <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e5</span></span></code></pre></div>
<div class="section level3">
<h3 id="group-aggregation">Group aggregation<a class="anchor" aria-label="anchor" href="#group-aggregation"></a>
</h3>
<p>In many cases, we will want to aggregate our data across non-age
groups, such as when looking at prevalence estimates or to simply
consolidate our non-age sociodemographic groups. In our Michigan
dataset, we have 10 years of data over which we can consolidate to look
at prevalence. In these cases, we need to pull in the population array
as a weight. First, we need to check which margin contains our year
information using the <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  83   6  10 400</span></span></code></pre></div>
<p>Our <code>samples</code> array has four margins with dimensions
<code>83</code>, <code>6</code>, <code>10</code>, and <code>400</code>,
representing the spatial regions, age groups, time periods, and
iterations, respectively. Let’s set a variable <code>margin_time</code>
to represent our time period margin and aggregate our
<code>samples</code> estimates across 1988-1988 using the
<code><a href="../reference/aggregate_samples.html">aggregate_samples()</a></code> function. The population data needed to
weight our samples can be pulled from our <code>RSTr</code> model
object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">margin_time</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="va">mod_mst</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="va">samples_7988</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_samples.html">aggregate_samples</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">pop</span>, <span class="va">margin_time</span><span class="op">)</span></span></code></pre></div>
<p>Now, we have a standalone sample array for our 1988-1988 samples. But
what if we are interested in both the individual year data <em>and</em>
the prevalence data? We can alternatively bind these new samples to our
main <code>samples</code> array by adding in values for the
<code>bind_new</code> and <code>new_name</code> arguments:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_samples.html">aggregate_samples</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">pop</span>, <span class="va">margin_time</span>, bind_new <span class="op">=</span> <span class="cn">TRUE</span>, new_name <span class="op">=</span> <span class="st">"1979-1988"</span><span class="op">)</span></span></code></pre></div>
<p>Group-aggregation is a feature unique to only samples;
group-aggregation cannot be performed on model objects.</p>
</div>
<div class="section level3">
<h3 id="age-standardization">Age-standardization<a class="anchor" aria-label="anchor" href="#age-standardization"></a>
</h3>
<p>The process of age-standardization is similar to that of
group-aggregation, but requires a bit more nuance in its use. We can
also use our samples to age-standardize these into a 35-64 group. Like
before, since we are using data from 1988-1988, we can use 1980 standard
populations from <a href="https://seer.cancer.gov/stdpopulations/stdpop.19ages.html" class="external-link">NIH</a>
to generate a <code>std_pop</code> vector:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span><span class="op">)</span></span>
<span><span class="va">std_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">113154</span>, <span class="fl">100640</span>, <span class="fl">95799</span><span class="op">)</span></span></code></pre></div>
<p>With <code>std_pop</code> generated, we need to then check which
margin contains our age group information using the <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code>
function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  83   6  11 400</span></span></code></pre></div>
<p>Our age groups lay along the second margin. Let’s set a variable
<code>margin_age</code> and standardize our <code>samples</code>
estimates across ages 35-64 using the <code><a href="../reference/standardize_samples.html">standardize_samples()</a></code>
function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">margin_age</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span><span class="op">)</span></span>
<span><span class="va">samples_3564</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_samples.html">standardize_samples</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">std_pop</span>, <span class="va">margin_age</span>, <span class="va">groups</span><span class="op">)</span></span></code></pre></div>
<p>Note that there may be times where you have groups stratified by both
age and other sociodemographic groups. In these cases, you’ll have to
refactor your sample array so that the age groups are separated from
your other groups before doing age-standardization, such as using
<code><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table()</a></code> in conjunction with
<code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>.</p>
<p>Now, we have a standalone array for our age-standardized 35-64 age
group. Similarly to <code><a href="../reference/aggregate_samples.html">aggregate_samples()</a></code>, we can
alternatively consolidate this into our main <code>samples</code> array
by adding in values for the <code>bind_new</code> and
<code>new_name</code> arguments:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_samples.html">standardize_samples</a></span><span class="op">(</span></span>
<span>  <span class="va">samples</span>,</span>
<span>  <span class="va">std_pop</span>,</span>
<span>  <span class="va">margin_age</span>,</span>
<span>  <span class="va">groups</span>,</span>
<span>  bind_new <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  new_name <span class="op">=</span> <span class="st">"35-64"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, our samples for <code>samples</code> are aggregated by year and
age-standardized, and we have matching array values for
<code>pop</code>. Note that if you plan on doing a mix of non-age
aggregation and age-standardization, do age-standardization
<em>after</em> aggregation, as doing age-standardization first will
alter the results of any aggregation done afterward.</p>
</div>
</div>
<div class="section level2">
<h2 id="estimates-and-reliability">Estimates and Reliability<a class="anchor" aria-label="anchor" href="#estimates-and-reliability"></a>
</h2>
<p>To get our medians, we simply put our samples into get_medians():</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medians</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_medians.html">get_medians</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span></code></pre></div>
<p>Let’s get some reliability metrics for our dataset. First, let’s
generate our relative precisions at 95% credibility using the
<code><a href="../reference/get_medians.html">get_credible_interval()</a></code> and
<code><a href="../reference/get_medians.html">get_relative_precision()</a></code> functions, then create a
<code>logical</code> <code>array</code> that tells us which estimates
are unreliable:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_medians.html">get_credible_interval</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">samples</span>, perc_ci <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">rel_prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_medians.html">get_relative_precision</a></span><span class="op">(</span><span class="va">medians</span>, <span class="va">ci</span><span class="op">)</span></span>
<span><span class="va">low_rel_prec</span> <span class="op">&lt;-</span> <span class="va">rel_prec</span> <span class="op">&lt;</span> <span class="fl">1</span></span></code></pre></div>
<p>Now, let’s generate a similar <code>logical</code> <code>array</code>
for populations less than 1000 and use these criteria to create a set of
suppressed medians. A median will be suppressed if it meets either of
the two criteria. Note that since our samples are age-standardized, we
also have to extend our <code>pop</code> array to match in size using
the <code><a href="../reference/aggregate_count.html">aggregate_count()</a></code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_count.html">aggregate_count</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">margin_age</span>, groups <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, bind_new <span class="op">=</span> <span class="cn">TRUE</span>, new_name <span class="op">=</span> <span class="st">"35-64"</span><span class="op">)</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_count.html">aggregate_count</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">margin_time</span>, bind_new <span class="op">=</span> <span class="cn">TRUE</span>, new_name <span class="op">=</span> <span class="st">"1988-1988"</span><span class="op">)</span></span>
<span><span class="va">low_population</span> <span class="op">&lt;-</span> <span class="va">pop</span> <span class="op">&lt;</span> <span class="fl">1000</span></span>
<span><span class="va">medians_supp</span> <span class="op">&lt;-</span> <span class="va">medians</span></span>
<span><span class="va">medians_supp</span><span class="op">[</span><span class="va">low_rel_prec</span> <span class="op">|</span> <span class="va">low_population</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Let’s now map our suppressed estimates:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">est_3544</span> <span class="op">&lt;-</span> <span class="va">medians_supp</span><span class="op">[</span>, <span class="st">"35-44"</span>, <span class="st">"1988"</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mishp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">est_3544</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Smoothed Myocardial Infarction Death Rates in MI, Ages 35-44, 1988"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Deaths per 100,000"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RSTr-samples_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" width="700"></p>
<p>With our samples available, we can generate estimates from different
credible intervals without having to re-run the model:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_medians.html">get_credible_interval</a></span><span class="op">(</span><span class="va">samples</span>, <span class="fl">0.995</span><span class="op">)</span></span>
<span><span class="va">rel_prec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_medians.html">get_relative_precision</a></span><span class="op">(</span><span class="va">medians</span>, <span class="va">ci</span><span class="op">)</span></span>
<span><span class="va">low_rel_prec</span> <span class="op">&lt;-</span> <span class="va">rel_prec50</span> <span class="op">&lt;</span> <span class="fl">1</span></span>
<span><span class="va">medians_supp</span> <span class="op">&lt;-</span> <span class="va">medians</span></span>
<span><span class="va">medians_supp</span><span class="op">[</span><span class="va">low_rel_prec</span> <span class="op">|</span> <span class="va">low_population</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">est_3544</span> <span class="op">&lt;-</span> <span class="va">medians_supp</span><span class="op">[</span>, <span class="st">"35-44"</span>, <span class="st">"1988"</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mishp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">est_3544</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Smoothed Myocardial Infarction Death Rates in MI, 99.5% CI, Ages 35-44, 1988"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Deaths per 100,000"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RSTr-samples_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" width="700"></p>
<p>We can even use these samples to learn more about our data. Let’s say
we are interested in figuring out if a rate estimate is statistically
significantly greater than or less than the overall state rate. We can
calculate a crude state rate for our 35-44 age group, then compare that
against our samples. Note that we can make statistical significance
comparisons, even if our rates are unreliable:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crude_3544</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mod_mst</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>, <span class="st">"35-44"</span>, <span class="st">"1988"</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mod_mst</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n</span><span class="op">[</span>, <span class="st">"35-44"</span>, <span class="st">"1988"</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e5</span></span>
<span><span class="va">sample_3544</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span>, <span class="st">"35-44"</span>, <span class="st">"1988"</span>, <span class="op">]</span></span>
<span><span class="va">p_higher</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">sample_3544</span>, <span class="fl">1</span>, \<span class="op">(</span><span class="va">county</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">county</span> <span class="op">&gt;</span> <span class="va">crude_3544</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mishp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">p_higher</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Probability that County Rate &gt; State Rate MI, Ages 35-44, 1988"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Probability"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdBu"</span>, trans <span class="op">=</span> <span class="st">"reverse"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RSTr-samples_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" width="700"></p>
<p>On this map, we can see that much of the northern Lower Peninsula is
significantly lower than the state rate, whereas the southern portion of
the LP has many places with significantly higher rates. The western
Upper Peninsula also shows areas of significantly higher rates.</p>
</div>
<div class="section level2">
<h2 id="closing-thoughts">Closing Thoughts<a class="anchor" aria-label="anchor" href="#closing-thoughts"></a>
</h2>
<p>In this vignette, we discussed features unique to sample processing
like <code><a href="../reference/aggregate_samples.html">aggregate_samples()</a></code>, more granual control over our
samples, and extensions of our analysis using samples.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David DeLara, Centers for Disease Control and Prevention.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
