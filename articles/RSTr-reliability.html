<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>05: Generating Estimates: Reliability and Suppression • RSTr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="05: Generating Estimates: Reliability and Suppression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RSTr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/RSTr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/RSTr-event.html">01: Understanding and Preparing Your Event Data</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-adjacency.html">02: Understanding and Preparing Your Adjacency Structure</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-car.html">03: The CAR Models</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-agestandardize.html">04: Generating Estimates: Age-standardization</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-reliability.html">05: Generating Estimates: Reliability and Suppression</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-informativeness.html">06: Model Informativeness</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-samples.html">07: Sample Processing</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-initialvalues.html">08: Initial Values</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-priors.html">09: Priors</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-models.html">Appendix A: The CAR Hierarchical Models</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-troubleshoot.html">Appendix B: Troubleshooting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>05: Generating Estimates: Reliability and Suppression</h1>
            
      

      <div class="d-none name"><code>RSTr-reliability.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Though <code>RSTr</code> is designed to stabilize low-population
regions, there is a limit to the amount of information the model can
gather, and estimates from exceedingly low-population regions may be
over-smoothed. To address these issues, we can establish criteria that
indicate whether our estimates are reliable enough to display. In this
vignette, we will take a deep dive into estimate reliability and
showcase how we can use reliability criteria to suppress our estimates
with <code><a href="../reference/suppress_estimates.html">suppress_estimates()</a></code>.</p>
<div class="section level3">
<h3 id="traceplots">Traceplots<a class="anchor" aria-label="anchor" href="#traceplots"></a>
</h3>
<p>Let’s quickly demonstrate the importance of reliability metrics by
comparing the traceplots of high- and low-population counties:</p>
<p><img src="images/reliability-figures.png"></p>
<p>Here, we have two traceplots representing our sample values over time
for a given county-group-year. On the left, we can see a traceplot for
the highest-population county, and on the right is a traceplot for the
lowest-population county. Each traceplot also includes a red line
representing the mean event rate for that county-group-year. Note that
in both traceplots, the mean line is nearby the plots, but either higher
or lower than their general trend, indicating that the rates in both of
these counties were attenuated thanks to spatial smoothing.</p>
<p>The traceplot on the left is exactly what we want to see: it is
clearly fluctuating around a certain value. The right traceplot,
however, is a bit less favorable: the value doesn’t seem to want to
stabilize and jumps between values over the course of the model.
However, the rate itself is naturally high, so the intensity of the
fluctuation isn’t shocking. Smaller counties like the one shown here
demonstrate the limits of <code>RSTr</code>: while the samples do hover
around a single value for some iterations, the estimated values we would
get for the county-group-year on the right will not be as reliable as
estimates on the left due to the large variability of the samples
gathered. Estimates like these are why we need standard measures of
reliability.</p>
<p>Reliability can be easily tested in CAR models using two
criteria:</p>
<ul>
<li>Relative precision: In <a href="https://doi.org/10.1177/0282423X241244917" class="external-link">Quick, et al 2024</a>,
relative precision is measured as a ratio of the posterior median to its
credible interval. If an estimate’s ratio is less than 1, then that
estimate is considered unreliable at that level of credibility.
Effectively, this means that unreliable estimates have a spread of
samples larger than the value of the estimate itself; and</li>
<li>Population counts: Because of the limitations of <code>RSTr</code>’s
models to gather information from low-population areas, estimates from
any region that fall below a specified threshold will be considered
unreliable, regardless of relative precision. Use your judgment when
setting this threshold depending on what kind of data you are working
with: for example, 1,000 population is generally a good rule of thumb
for mortality data, whereas an appropriate cutoff for birth data is
closer to 100. Note that this population count metric only applies for
unrestricted models; the enhancements of the restricted CAR models mean
that we don’t need this criterion when evaluating reliability.</li>
</ul>
<p>Let’s get some reliability metrics for our dataset. The
<code><a href="../reference/ucar.html">mstcar()</a></code> function automatically generates credible
intervals and relative precisions based on the <code>perc_ci</code>
argument:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_mst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ucar.html">mstcar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"my_test_model"</span>, data <span class="op">=</span> <span class="va">miheart</span>, adjacency <span class="op">=</span> <span class="va">miadj</span>, seed <span class="op">=</span> <span class="fl">1234</span>, perc_ci <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting sampler on Batch 1 at Thu Dec 11 00:06:43</span></span></code></pre></div>
<p><img src="RSTr-reliability_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" width="700"></p>
<pre><code><span><span class="co">#&gt; Generating estimates...</span></span>
<span><span class="co">#&gt; Model finished at Thu Dec 11 00:07:12</span></span></code></pre>
<p>Here, we specify <code>perc_ci = 0.95</code>, which means our
relative precision estimates will be based on a 95% credible interval.
If we want to generate our suppressed estimates, we can simply input our
<code>RSTr</code> model object into the
<code><a href="../reference/suppress_estimates.html">suppress_estimates()</a></code> function. Since we are using an MSTCAR
model, we have to specify a population threshold to suppress counties
with small population counts:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_mst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suppress_estimates.html">suppress_estimates</a></span><span class="op">(</span><span class="va">mod_mst</span>, threshold <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span><span class="va">mod_mst</span></span>
<span><span class="co">#&gt; RSTr object:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model name: my_test_model </span></span>
<span><span class="co">#&gt; Model type: MSTCAR </span></span>
<span><span class="co">#&gt; Data likelihood: binomial </span></span>
<span><span class="co">#&gt; Estimate Credible Interval: 95% </span></span>
<span><span class="co">#&gt; Number of geographic units: 83 </span></span>
<span><span class="co">#&gt; Number of samples: 6000 </span></span>
<span><span class="co">#&gt; Estimates age-standardized: No </span></span>
<span><span class="co">#&gt; Estimates suppressed: Yes </span></span>
<span><span class="co">#&gt; Number of reliable rates: 3605 / 4980 (72.4%)</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_estimates.html">get_estimates</a></span><span class="op">(</span><span class="va">mod_mst</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="co">#&gt;   county group year  medians medians_suppressed credible_interval_lower</span></span>
<span><span class="co">#&gt; 1  26001 35-44 1979 41.98634                 NA                29.79605</span></span>
<span><span class="co">#&gt; 2  26003 35-44 1979 51.00178                 NA                37.86450</span></span>
<span><span class="co">#&gt; 3  26005 35-44 1979 23.76272           23.76272                16.29719</span></span>
<span><span class="co">#&gt; 4  26007 35-44 1979 33.61042           33.61042                24.15788</span></span>
<span><span class="co">#&gt; 5  26009 35-44 1979 29.70584           29.70584                22.96456</span></span>
<span><span class="co">#&gt; 6  26011 35-44 1979 38.17390                 NA                24.89862</span></span>
<span><span class="co">#&gt;   credible_interval_upper relative_precision events population</span></span>
<span><span class="co">#&gt; 1                56.17417          1.5917110      1        964</span></span>
<span><span class="co">#&gt; 2               119.49006          0.6248260      1       1011</span></span>
<span><span class="co">#&gt; 3                33.58478          1.3745537      0       9110</span></span>
<span><span class="co">#&gt; 4                45.44376          1.5790005      0       3650</span></span>
<span><span class="co">#&gt; 5                39.27994          1.8207267      0       1763</span></span>
<span><span class="co">#&gt; 6                65.99126          0.9289717      0       1470</span></span></code></pre></div>
<p>By default, <code><a href="../reference/suppress_estimates.html">suppress_estimates()</a></code> will suppress based on
population counts, but by specifying <code>type = "event"</code>, you
can alternatively use an event count threshold. This is helpful when
maintaining consistency with datasets that suppress by events instead of
population, such as CDC WONDER. Notice that the first two regions in the
35-44 age group have been suppressed; the first was suppressed by
population (964) and the second was suppressed by relative precision
(0.925). Now, we can map out our county estimates with suppression:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">est_3544</span> <span class="op">&lt;-</span> <span class="va">estimates</span><span class="op">$</span><span class="va">medians_suppressed</span><span class="op">[</span><span class="va">estimates</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">"35-44"</span> <span class="op">&amp;</span> <span class="va">estimates</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"1988"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mishp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">est_3544</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Smoothed Myocardial Infarction Death Rates in MI, Ages 35-44, 1988"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Deaths per 100,000"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RSTr-reliability_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" width="700"></p>
<p>These suppressed maps highlight an important benefit of
age-standardizing: we can combine age groups to both bolster our
relative precisions and to increase the total population in our groups,
increasing values for both suppression criteria. Let’s age-standardize
to 35-64 and see what counties are suppressed:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">std_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">113154</span>, <span class="fl">100640</span>, <span class="fl">95799</span><span class="op">)</span></span>
<span><span class="va">mod_mst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/age_standardize.html">age_standardize</a></span><span class="op">(</span><span class="va">mod_mst</span>, <span class="va">std_pop</span>, new_name <span class="op">=</span> <span class="st">"35-64"</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_estimates.html">get_estimates</a></span><span class="op">(</span><span class="va">mod_mst</span><span class="op">)</span></span></code></pre></div>
<p>The <code>RSTr</code> model object remembers that we’ve suppressed
our estimates and automatically performs suppression on our
age-standardized estimates. Let’s map our age-standardized rates:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_3564</span> <span class="op">&lt;-</span> <span class="va">estimates</span><span class="op">$</span><span class="va">medians_suppressed</span><span class="op">[</span><span class="va">estimates</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">"35-64"</span> <span class="op">&amp;</span> <span class="va">estimates</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"1988"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mishp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">est_3564</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Smoothed Myocardial Infarction Death Rates in MI, Ages 35-64, 1988"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Deaths per 100,000"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RSTr-reliability_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="700"></p>
<p>As we increase our CI width from 0.50 to 0.95 to 0.99 and 0.995, our
reliability criteria becomes more stringent and more counties become
grayed out. It is important to find a good balance between credible
interval choice and displaying of estimates; the traditionally-used
credible interval of 95% provides a happy medium of these two
factors.</p>
</div>
</div>
<div class="section level2">
<h2 id="final-thoughts">Final thoughts<a class="anchor" aria-label="anchor" href="#final-thoughts"></a>
</h2>
<p>In this vignette, we investigated measures of reliability and
observed how reliability measures change which data are suppressed. This
vignette concludes the main sections on using the functions in the
<code>RSTr</code> package. After reading these, you should be able to
prepare your event and adjacency data, configure your model as
necessary, age-standardize estimates, and determine which estimates are
reliable. If you are interested in more advanced features of the
<code>RSTr</code> involving sample processing, read
<code><a href="../articles/RSTr-samples.html">vignette("RSTr-samples")</a></code>; if you’d like more information on
defining custom <code>initial_values</code> and <code>priors</code>,
check <code><a href="../articles/RSTr-initialvalues.html">vignette("RSTr-initialvalues")</a></code> and
<code><a href="../articles/RSTr-priors.html">vignette("RSTr-priors")</a></code>, respectively; if you are
interested in learning more about how the MSTCAR model itself works,
read <code><a href="../articles/RSTr-models.html">vignette("RSTr-models")</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David DeLara, Centers for Disease Control and Prevention.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
