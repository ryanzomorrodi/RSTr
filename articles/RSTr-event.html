<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>01: Understanding and Preparing Your Event Data • RSTr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="01: Understanding and Preparing Your Event Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RSTr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/RSTr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/RSTr-event.html">01: Understanding and Preparing Your Event Data</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-adjacency.html">02: Understanding and Preparing Your Adjacency Structure</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-car.html">03: The CAR Models</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-agestandardize.html">04: Generating Estimates: Age-standardization</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-reliability.html">05: Generating Estimates: Reliability and Suppression</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-informativeness.html">06: Model Informativeness</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-samples.html">07: Sample Processing</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-initialvalues.html">08: Initial Values</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-priors.html">09: Priors</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-models.html">Appendix A: The CAR Hierarchical Models</a></li>
    <li><a class="dropdown-item" href="../articles/RSTr-troubleshoot.html">Appendix B: Troubleshooting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>01: Understanding and Preparing Your Event Data</h1>
            
      

      <div class="d-none name"><code>RSTr-event.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="sec-overview">Overview<a class="anchor" aria-label="anchor" href="#sec-overview"></a>
</h2>
<p>The event and population data are at the core of the BYM-based models
used in the <code>RSTr</code> package. They work alongside the adjacency
information to generate smoothed estimates. In this vignette, we’ll
discuss requirements for event and population data and walk through an
example with a <code>data.frame</code>.</p>
</div>
<div class="section level2">
<h2 id="sec-requirements">Requirements<a class="anchor" aria-label="anchor" href="#sec-requirements"></a>
</h2>
<ul>
<li><p>Data must be a <code>list</code> object with names <code>Y</code>
and <code>n</code> for the event counts and for the population counts,
respectively;</p></li>
<li><p><code>Y</code> and <code>n</code> are intended to be
entire-population data. While it is possible to use <code>RSTr</code> to
analyze survey data or datasets that don’t include all members of a
population of interest, <code>RSTr</code> does not currently allow for
the inclusion of survey weights and thus assumes that each
<code>Y / n</code> is an unbiased estimate of the underlying event
rate;</p></li>
<li><p><code>Y</code> and <code>n</code> must contain real numbers.
Negative and infinite counts are not allowed, but suppressed data
containing <code>NA</code>’s is acceptable for the <code>Y</code>
values. Note, however, that <code>n</code> must have all population
counts;</p></li>
<li><p>For a given CAR model, <code>Y</code> must have at least one
total event. The CAR model will not be able to smooth information if
there is no event data present. For a UCAR model, this includes any set
of all regions; for an MCAR model, this is any set of all regions and
groups; and for the MSTCAR model, this is the entire dataset;</p></li>
<li><p><code>Y</code> and <code>n</code> can be up to a
three-dimensional array: the first margin (rows) specifies the region,
the second margin (columns) specifies the groups of interest, and the
third margin (matrix slices) specifies the time period;</p></li>
<li><p>Time periods, regions, and groups must be consistent. If your
data contains counts for all regions in a specified set of groups for
1979 and 1981, for example, it must also include counts for all regions
and all groups for 1980 as well, even if those counts have zero
events;</p></li>
<li><p>Groups of many types are allowed as long as your sociodemographic
groups are combined in the appropriate margin. For example, your groups
may include just age groups, a mixture of age-sex groups, or even a mix
of age-race-sex groups;</p></li>
<li><p>Finally, <code>Y</code> and <code>n</code> must have dimension
names associated with them. This makes for easy identification of
counties, groups, and time periods, and is necessary should you want to
age-standardize data using <code>RSTr</code>’s additional
functionality.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="sec-example">Example: CDC WONDER dataset<a class="anchor" aria-label="anchor" href="#sec-example"></a>
</h2>
<p>To walk through the data setup from a <code>data.frame</code> to the
final <code>array</code> <code>list</code>, we will use data generated
by CDC WONDER’s Underlying Cause of Death Compressed Mortality, ICD-9
database, found at <a href="https://wonder.cdc.gov/cmf-icd9.html" class="external-link uri">https://wonder.cdc.gov/cmf-icd9.html</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">maexample</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Notes Year Year.Code                County County.Code    Sex Sex.Code Deaths</span></span>
<span><span class="co">#&gt; 1       1979      1979 Barnstable County, MA       25001 Female        F     15</span></span>
<span><span class="co">#&gt; 2       1979      1979 Barnstable County, MA       25001   Male        M     57</span></span>
<span><span class="co">#&gt; 3       1979      1979  Berkshire County, MA       25003 Female        F     11</span></span>
<span><span class="co">#&gt; 4       1979      1979  Berkshire County, MA       25003   Male        M     63</span></span>
<span><span class="co">#&gt; 5       1979      1979    Bristol County, MA       25005 Female        F     52</span></span>
<span><span class="co">#&gt; 6       1979      1979    Bristol County, MA       25005   Male        M    191</span></span>
<span><span class="co">#&gt;   Population        Crude.Rate</span></span>
<span><span class="co">#&gt; 1      25239 59.4 (Unreliable)</span></span>
<span><span class="co">#&gt; 2      21261             268.1</span></span>
<span><span class="co">#&gt; 3      24884 44.2 (Unreliable)</span></span>
<span><span class="co">#&gt; 4      22465             280.4</span></span>
<span><span class="co">#&gt; 5      80171              64.9</span></span>
<span><span class="co">#&gt; 6      71943             265.5</span></span></code></pre></div>
<p>Our example dataset contains acute myocardial infarction (ICD-9: 410)
mortality and population data in all counties of Massachusetts for men
and women aged 35-64 from 1979 to 1981. This dataset also includes some
notes in the bottom rows describing the dataset. <code>maexample</code>
contains several variables:</p>
<ul>
<li><p><code>Notes</code>: Provides general information about the
dataset, starting at row 85;</p></li>
<li><p><code>Year</code> and <code>Year.Code</code> specify the
year;</p></li>
<li><p><code>County</code> and <code>County.Code</code> specify the
county name and associated FIPS code;</p></li>
<li><p><code>Sex</code> and <code>Sex.Code</code> specify the sex
group;</p></li>
<li><p><code>Deaths</code> contains our mortality counts of
interest;</p></li>
<li><p><code>Population</code> contains our population counts of
interest;</p></li>
<li><p><code>Crude.Rate</code> shows the rates per 100,000 in each
year-county-sex group. For our purposes, this column can be
ignored.</p></li>
</ul>
<p>The first thing we want to do with our dataset is remove the notes
from the bottom rows - while they are useful for getting acquainted with
the dataset, they will ultimately mess up our population arrays. Since
<code>Year</code> does not have information in rows with notes, we can
use that to filter our data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ma_mort</span> <span class="op">&lt;-</span> <span class="va">maexample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">maexample</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>The above code searches for values in <code>maexample$Year</code>
that aren’t <code>NA</code> and creates a new dataset containing only
those rows. Before we start generating our arrays, let’s take stock of
how our data is listed out:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ma_mort</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Notes Year Year.Code                County County.Code    Sex Sex.Code Deaths</span></span>
<span><span class="co">#&gt; 1       1979      1979 Barnstable County, MA       25001 Female        F     15</span></span>
<span><span class="co">#&gt; 2       1979      1979 Barnstable County, MA       25001   Male        M     57</span></span>
<span><span class="co">#&gt; 3       1979      1979  Berkshire County, MA       25003 Female        F     11</span></span>
<span><span class="co">#&gt; 4       1979      1979  Berkshire County, MA       25003   Male        M     63</span></span>
<span><span class="co">#&gt; 5       1979      1979    Bristol County, MA       25005 Female        F     52</span></span>
<span><span class="co">#&gt; 6       1979      1979    Bristol County, MA       25005   Male        M    191</span></span>
<span><span class="co">#&gt;   Population        Crude.Rate</span></span>
<span><span class="co">#&gt; 1      25239 59.4 (Unreliable)</span></span>
<span><span class="co">#&gt; 2      21261             268.1</span></span>
<span><span class="co">#&gt; 3      24884 44.2 (Unreliable)</span></span>
<span><span class="co">#&gt; 4      22465             280.4</span></span>
<span><span class="co">#&gt; 5      80171              64.9</span></span>
<span><span class="co">#&gt; 6      71943             265.5</span></span></code></pre></div>
<p>RSTr offers a <code><a href="../reference/generate_data.html">generate_data()</a></code> function which can
transform this dataset into mortality and population arrays with
properly oriented margins:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ma_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data.html">generate_data</a></span><span class="op">(</span><span class="va">ma_mort</span>, <span class="va">Deaths</span>, <span class="va">Population</span>, <span class="va">County.Code</span>, <span class="va">Sex.Code</span>, <span class="va">Year.Code</span><span class="op">)</span></span></code></pre></div>
<p>If you want to manually set up the data, you can create
<code>Y</code> and <code>n</code> arrays using the <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>
function and consolidate them into a <code>list</code> to be used with
the model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">Deaths</span> <span class="op">~</span> <span class="va">County.Code</span> <span class="op">+</span> <span class="va">Sex.Code</span> <span class="op">+</span> <span class="va">Year.Code</span>, data <span class="op">=</span> <span class="va">ma_mort</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">Population</span> <span class="op">~</span> <span class="va">County.Code</span> <span class="op">+</span> <span class="va">Sex.Code</span> <span class="op">+</span> <span class="va">Year.Code</span>, data <span class="op">=</span> <span class="va">ma_mort</span><span class="op">)</span></span>
<span><span class="va">ma_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>Note that you must specify the names of each array element as above,
as creating a list with just the objects will not name each element, and
the names <code>Y</code> and <code>n</code> are necessary for
<code>RSTr</code> to know how to use the data.</p>
<p>If you have multiple types of groups, such as race and sex, it can
take a little finessing to set up your group data, such as creating a
combined race-sex group variable, but data setup will follow the same
principles as above.</p>
</div>
<div class="section level2">
<h2 id="data-setup-for-other-models">Data setup for other models<a class="anchor" aria-label="anchor" href="#data-setup-for-other-models"></a>
</h2>
<p>The above dataset is prepared specifically for an MSTCAR model. But
what if we want to prepare data for an MCAR or even a UCAR model? We can
filter the original dataset and follow a similar procedure to prepare
our data for the MCAR model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ma_mort_mcar</span> <span class="op">&lt;-</span> <span class="va">maexample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">maexample</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">ma_mort_mcar</span> <span class="op">&lt;-</span> <span class="va">ma_mort_mcar</span><span class="op">[</span><span class="va">ma_mort_mcar</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1979</span>, <span class="op">]</span> <span class="co"># filter dataset to only show 1979 data</span></span>
<span><span class="va">ma_data_mcar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data.html">generate_data</a></span><span class="op">(</span><span class="va">ma_mort_mcar</span>, <span class="va">Deaths</span>, <span class="va">Population</span>, <span class="va">County.Code</span>, <span class="va">Sex.Code</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code> works by aggregating data along the
specified variables in the expression argument. In the case of the MCAR
model, we filter down to the year we want because otherwise, it would
give us the mortality and population counts for all years in our dataset
instead of just for 1979.</p>
<p>For the UCAR model, setup is similar:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ma_mort_ucar</span> <span class="op">&lt;-</span> <span class="va">maexample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">maexample</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">ma_mort_ucar</span> <span class="op">&lt;-</span> <span class="va">ma_mort_ucar</span><span class="op">[</span><span class="va">ma_mort_ucar</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1979</span> <span class="op">&amp;</span> <span class="va">ma_mort_ucar</span><span class="op">$</span><span class="va">Sex</span> <span class="op">==</span> <span class="st">"Male"</span>, <span class="op">]</span> <span class="co"># filter dataset to only show 1979 data for men</span></span>
<span><span class="va">ma_data_ucar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data.html">generate_data</a></span><span class="op">(</span><span class="va">ma_mort_ucar</span>, <span class="va">Deaths</span>, <span class="va">Population</span>, <span class="va">County.Code</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="closing-thoughts">Closing Thoughts<a class="anchor" aria-label="anchor" href="#closing-thoughts"></a>
</h2>
<p>In this vignette, we used data generated from CDC WONDER to construct
our event and population counts, remove unnecessary rows using
<code><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter()</a></code>, and construct our list using
<code><a href="../reference/generate_data.html">generate_data()</a></code>. Setting up the data for <code>RSTr</code>
can seem daunting at first, but with a few quick tricks in R, it can be
easy to have your data organized for analysis.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David DeLara, Centers for Disease Control and Prevention.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
